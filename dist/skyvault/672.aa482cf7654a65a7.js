"use strict";(self.webpackChunkskyvault=self.webpackChunkskyvault||[]).push([[672],{8672:(N,m,a)=>{a.r(m),a.d(m,{B4uModule:()=>S});var d=a(6019),y=a(7537),h=a(4708),g=a(4762),t=a(3556),x=a(3755),v=a(4071),p=a(4522),w=a(5894),f=a(3213);function b(n,c){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij("to ",e.merchantName,"")}}function C(n,c){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",4),t._UZ(2,"img",5),t._UZ(3,"div",6),t.TgZ(4,"p"),t._uU(5,"Do you want to send "),t.TgZ(6,"span",7),t._uU(7),t.qZA(),t._UZ(8,"br"),t.YNc(9,b,2,1,"span",2),t._uU(10),t.qZA(),t._UZ(11,"div",8),t.TgZ(12,"div",9),t.TgZ(13,"div",10),t.TgZ(14,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw().payment()}),t._uU(15,"SEND PAYMENT AND NOTIFY MERCHANT"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(7),t.hij("",e.cc," Cloudcoins"),t.xp6(2),t.Q6J("ngIf",e.merchantName),t.xp6(1),t.hij(" for $",e.usd," ?")}}function I(n,c){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"ng-lottie",12),t.NdJ("animationCreated",function(s){return t.CHM(e),t.oxw().animationCreated(s)}),t.qZA(),t.TgZ(2,"div",13),t._uU(3),t.qZA(),t.TgZ(4,"div",14),t.TgZ(5,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw().hideErrorMessage()}),t._uU(6," Back "),t.qZA(),t.qZA(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("options",e.errorOptions),t.xp6(2),t.Oqu(e.errorMessage)}}function T(n,c){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",14),t.TgZ(2,"ng-lottie",15),t.NdJ("animationCreated",function(s){return t.CHM(e),t.oxw().animationCreated(s)}),t.qZA(),t.TgZ(3,"span",16),t._uU(4),t.qZA(),t.qZA(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("options",e.options),t.xp6(2),t.Oqu(e.loadingMessage)}}function M(n,c){if(1&n&&(t.TgZ(0,"div",17),t._UZ(1,"div",6),t._UZ(2,"div",18),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("innerHTML",e.completeMessage,t.oJD)}}const _=[{path:"",component:(()=>{class n{constructor(e,o,s,i,u,l){this.auth=e,this.router=o,this.skyvault=s,this.activatedRoute=i,this.http=u,this.indc=l,this.errorMessage=null,this.options={path:"/assets/animations/cloud_loading.json"},this.errorOptions={path:"/assets/animations/error.json"},this.showLoader=!1,this.showNormal=!0,this.showError=!1,this.complete=!1,this.completeMessage=null,this.loadingMessage=null,this.mySkyVault=null,this.cc=0,this.merchantName=null,this.memo=null,this.balanceLoader=!1,this.balance=0,this.balanceString="0",this.balanceBreakup=null,this.opinions=0,this.balances={},this.syncCount=0,this.processing=!1,localStorage.setItem("b4uPay","null"),localStorage.removeItem("b4uPay"),this.activatedRoute.queryParams.subscribe(r=>{this.cc=r.cc?r.cc:0,this.usd=r.usd?r.usd:null,this.guid=r.b4u?r.b4u:null,this.merchantID=r.m?r.m:null,this.merchantName=r.n?r.n:null,this.terminalID=r.t?r.t:null,this.paymentTo=r.to?r.to:null});const A={m:this.merchantID,t:this.terminalID,b4u:this.guid,cc:this.cc,to:this.paymentTo,usd:this.usd,mn:this.merchantName};this.auth.getLoggedIn()||(localStorage.setItem("b4uPay",JSON.stringify(A)),this.router.navigate(["/auth/drop-image"])),(!this.paymentTo||!this.usd||!this.guid||!this.merchantID||!this.terminalID)&&this.router.navigate(["balance"])}ngOnInit(){localStorage.setItem("job","0"),this.auth.getLoggedIn()||(this.auth.checkLoginStatus(),this.router.navigate(["/welcome"])),this.watch=this.auth.watch().subscribe(o=>{o||this.router.navigate(["/welcome"])});let e=0;this.watchIndicator=this.indc.currentRStatus.subscribe(o=>{0==Object.keys(o).length?(this.showLoading(!0),this.loadingMessage="Contacting RAIDA..."):(e++,!this.processing&&1==e&&setTimeout(()=>{this.showLoading(!1),this.checkBalance()},2e3))}),localStorage.getItem("skyvault")&&(this.mySkyVault=localStorage.getItem("skyvault"))}ngOnDestroy(){this.watch&&this.watch.unsubscribe(),this.watchIndicator&&this.watchIndicator.unsubscribe()}animationCreated(e){}showLoading(e){this.loadingMessage="",e?(this.showNormal=!1,this.showLoader=!0,this.showError=!1):(this.showNormal=!0,this.showLoader=!1,this.showError=!1)}showErrorMessage(e){this.errorMessage=e,this.showNormal=!1,this.showError=!0,this.showLoader=!1}hideErrorMessage(){this.errorMessage="",this.showNormal=!0,this.showError=!1,this.showLoader=!1}checkBalance(){return(0,g.mG)(this,void 0,void 0,function*(){if(this.showLoading(!0),this.auth.getLoggedIn()){localStorage.setItem("job","1");const e=this.auth.getToken(),o={sn:e.sn,an:e.an};let s=yield this.skyvault.showBalance(o);if(localStorage.setItem("job","0"),s){this.balance=0,this.opinions=0;let i=0,u=0;if(this.balanceBreakup='<div style="text-align: left; display: table;">Your SkyVault is out of sync. Balance returned by RAIDA servers are as follows: <ul style="text-align: left!important;">',s.balances){this.balances=s.balances;for(const l in s.balances)s.balances.hasOwnProperty(l)&&(this.balanceBreakup+='<li style="text-align: left!important">'+s.balances[l]+" RAIDA(s) - "+parseInt(l).toLocaleString()+" cc </li>",s.balances[l]>i&&(i=s.balances[l],u=parseInt(l),this.balance=u,this.balanceString=this.balance.toLocaleString())),this.opinions++;this.balanceBreakup+="</ul> It is advised that you sync your SkyVault by clicking the sync icon</div>",this.opinions>1&&0==this.syncCount&&(this.syncCount++,yield this.syncAccount())}}this.showLoading(!1)}else this.auth.checkLoginStatus(),this.router.navigate(["welcome"])})}syncAccount(){return(0,g.mG)(this,void 0,void 0,function*(){this.showLoading(!0),localStorage.setItem("job","1");let e=!1;if(this.auth.getLoggedIn()){const o=this.auth.getToken();this.loadingMessage="Synchronizing SkyVault";const s={sn:o.sn,an:o.an};let i=yield this.skyvault.fixCoins(s);if(console.log("SKYVAULT: apiFixTransfer response: ",i),"done"!=i.status)return this.showErrorMessage(i.errorText),void localStorage.setItem("job","0");e||(yield this.checkBalance(),e=!0)}else this.auth.checkLoginStatus(),this.router.navigate(["welcome"]);localStorage.setItem("job","0")})}payment(){return(0,g.mG)(this,void 0,void 0,function*(){if(isNaN(this.cc)||this.cc<1)return void this.showErrorMessage("Invalid amount");if(this.cc>this.balance)return void this.showErrorMessage("Not enough balance!! Current balance: "+this.balanceString+" CC");this.memo="Payment of $"+this.usd+" towards Merchant ID: "+this.merchantID+" and Terminal ID: "+this.terminalID,this.processing=!0,localStorage.setItem("job","1");const s={an:this.auth.getToken().an,amount:this.cc,to:this.paymentTo,memo:this.memo,sender_name:this.mySkyVault,guid:this.guid};this.showLoading(!0);let i=yield this.skyvault.payment(s);if(console.log("Payment response:",i),localStorage.setItem("job","0"),i){if("error"===i.status)return void("errorText"in i?-1!==i.errorText.indexOf("Failed to resolve")?this.showErrorMessage("Invalid Recipient SkyVault Address: "+this.paymentTo):this.showErrorMessage(i.errorText):this.showErrorMessage("Your login session is not valid, please logout and try again"));if(!("result"in i))return void this.showErrorMessage("Invalid response received");this.complete=!0,this.completeMessage="Payment completed",setTimeout(()=>{this.router.navigate(["/balance"])},2e3)}})}sleep(e){return new Promise(o=>setTimeout(o,e))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.r),t.Y36(h.F0),t.Y36(v._),t.Y36(h.gz),t.Y36(p.eN),t.Y36(w.Q))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-b4u"]],decls:6,vars:4,consts:[[1,"pageWrapper"],[1,"sectionWrapper"],[4,"ngIf"],["class","text-center subInnerHeader",4,"ngIf"],[1,"paymentWrap"],["src","assets/images/b4u-logo.png","alt","logo",1,"atmLogo"],[1,"gap20"],[1,"highlight"],[1,"gap10"],[1,"col-md-12"],[1,"button-wrapper"],[1,"buttonCustome",3,"click"],["height","100px",3,"options","animationCreated"],[1,"errorMsg",2,"color","#ffffff","margin-bottom","10px"],[1,"text-center"],["height","150px",3,"options","animationCreated"],[2,"color","#ffffff"],[1,"text-center","subInnerHeader"],[3,"innerHTML"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.YNc(2,C,16,3,"ng-container",2),t.YNc(3,I,7,2,"ng-container",2),t.YNc(4,T,5,2,"ng-container",2),t.YNc(5,M,3,1,"div",3),t.qZA(),t.qZA()),2&e&&(t.xp6(2),t.Q6J("ngIf",o.showNormal),t.xp6(1),t.Q6J("ngIf",o.showError),t.xp6(1),t.Q6J("ngIf",o.showLoader),t.xp6(1),t.Q6J("ngIf",o.complete))},directives:[d.O5,f.e$],styles:[".atmLogo[_ngcontent-%COMP%]{width:100%}.paymentWrap[_ngcontent-%COMP%]{max-width:1000px;height:initial;margin:0 auto;padding:15px;display:flex;justify-content:center;flex-direction:column;text-align:center}.paymentWrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30%;margin:0 auto 15px}@media (max-width: 576px){.paymentWrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-bottom:5px;width:70%}}.paymentWrap[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px;color:#fff;font-weight:500}@media (max-width: 600px){.paymentWrap[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}}.highlight[_ngcontent-%COMP%]{font-size:25px;font-weight:700}"]}),n})()}];let B=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[h.Bz.forChild(_)],h.Bz]}),n})();var Z=a(8329),k=a(745);let S=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[d.ez,B,y.u5,f.CT,Z.uH,k.z8,p.JF]]}),n})()}}]);